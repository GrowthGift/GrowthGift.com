<template name="game">
  {{#if data._xNotFound }}
  <div class='padding center'>Game either is still loading or does not exist. <a href='{{ data._xHref }}'>Return to My Games.</a></div>
  {{else}}
  <div class='max-600'>

    {{#if data.privileges.edit }}
      <div class='flexbox'>
        <div class='flex1'>&nbsp;</div>
        <div class='margin-r'><a class='' href='{{ data.privileges.editLink }}'>Edit Game</a></div>
      </div>
    {{/if}}
    {{#if data.privileges.leave }}
      <div class='flexbox'>
        <div class='flex1'>&nbsp;</div>
        <div class='btn-underline text-warning game-leave'>Leave Game</div>
      </div>
    {{/if}}

    <div><img class='img-100' src='{{ data.game.xDisplay.img }}' /></div>
    <div class='center margin-lr'>
      <h2>{{ data.game.title }}</h2>
      <h4>Goal: {{ data.game.actionGoal }} {{ data.gameRule.mainAction }}</h4>
      <div>
        <a href='{{ data.gameUsersLink }}'>{{ data.userChallengeTotals.numUsersText }}</a> |
        {{#if data.privileges.viewChallenges }}
        <a href='{{ data.gameChallengeLink }}'>
          <!-- {{ data.userChallengeTotals.userCompletions }} total challenge completions -->
          {{ data.userChallengeTotals.userActions }} total {{ data.gameRule.mainAction }}
        </a>
        {{else}}
        <!-- {{ data.userChallengeTotals.userCompletions }} challenge completions -->
        {{ data.userChallengeTotals.userActions }} total {{ data.gameRule.mainAction }}
        {{/if}}
      </div>
    </div>

    <!-- <div>Game Details: <a href='{{ data.game.xHref.gameRule }}'>{{ data.game.xHref.gameRuleText }}</a></div>
      <div>Start: {{ data.game.xDisplay.start }}</div> -->

    {{#if data.privileges.join }}
    <div class='center margin-b'>
      <div class='btn btn-primary margin-tb game-join'>
        {{#if data.privileges.buddy }}
          Join with {{ data.buddyName }}
        {{else}}
          Join Game
        {{/if}}
      </div>
      {{#if data.privileges.buddy }}
        <div class='red'>Join to become buddies with {{ data.buddyName }}.</div>
      {{/if}}
      {{#if data.buddyErrorMessage }}
        <div class='text-warning'>{{ data.buddyErrorMessage }}</div>
      {{/if}}
    </div>
    {{else}}
      {{#unless data.curChallenge.gameEnded}}
      <div class='center margin-b margin-large-t'>
        <a class='a-div btn btn-primary' href='{{ data.gameInviteLink }}'>Invite Friends</a>
      </div>
      {{/unless}}
    {{/if}}

    <!-- current challenge -->
    {{#if data.curChallenge.currentChallenge }}
      <div class='game-wrapper margin-large-tb margin-lr'>
        <div class='game-subheader-wrapper flexbox'>
          <div class='game-subheader flex1'>Current challenge:</div>
          <div>Ends {{ data.curChallenge.currentChallenge.xDisplay.end }}</div>
        </div>
        <div>
          <span class='h5'>{{ data.curChallenge.currentChallenge.title }}:</span>
          <span> {{ data.curChallenge.currentChallenge.description }}</span>
        </div>

        {{#if data.privileges.addChallenge }}
        <div class='margin-tb center'>
          <a class='a-div btn btn-primary' href='{{ data.gameChallengeLink }}'>Do the Challenge</a>
        </div>
        {{/if}}
      </div>
    {{/if}}

    <!-- next challenge (includes if game has not started) -->
    {{#if data.curChallenge.nextChallenge }}
      <div class='game-wrapper margin-large-tb margin-lr'>
        <div class='game-subheader-wrapper flexbox'>
          <div class='game-subheader flex1'>Next challenge:</div>
          <div>Starts {{ data.curChallenge.nextChallenge.xDisplay.start }}</div>
        </div>
        <div>
          <span class='h5'>{{ data.curChallenge.nextChallenge.title }}:</span>
          <span> {{ data.curChallenge.nextChallenge.description }}</span>
        </div>
      </div>
    {{/if}}

    <!-- game is over (or user has already added his last challenge so it is over for him) -->
    {{#if data.curChallenge.gameStarted }}
      {{#if data.gameEndedForUser }}
        <div class='game-wrapper margin-large-tb margin-lr'>
          <div class='game-subheader-wrapper'><div class='game-subheader'>Game Stats</div></div>
          {{#if data.privileges.viewChallenges }}
            <a href='{{ data.gameChallengeLink }}'>Your game challenges: {{ data.challenges.selfCompletions }} / {{ data.challenges.possibleCompletions }}</a>
          {{else}}
            <a href='{{ data.gameUsersLink }}'>{{ data.userChallengeTotals.numUsersText }}</a> | 
            <!-- {{ data.userChallengeTotals.userCompletions }} challenge completions -->
            {{ data.userChallengeTotals.userActions }} total {{ data.gameRule.mainAction }}
          {{/if}}
        </div>
      {{/if}}
    {{/if}}

    <div class='margin-b margin-xlarge-t center'>
      <a href='/about'>What is Growth Gift?</a>
    </div>
  </div>
  {{/if}}
</template>